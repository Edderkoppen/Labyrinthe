<!doctype html>

<html>
<head>
    <title>Labyrinthe</title>

    <!----------------- CSS ----------------->

<style>

    table {
      border-collapse: collapse;
      border-spacing: 0px;
    }

    td {

      padding: 0;
      margin: 0;
      display: inline-flex;
    }

    </style>

</head>

<!----------------- HTML ----------------->

    <body>

      <div>
        <div id="laby"></div>
        <input type="button" value="ENTER THE DUNJEON" onclick="go();"><br/><BR><BR>
        <div class="meta">
      </div>
        <section id="clock">
            <div class="timer">00:00:00</div>
        </section>

        <button id="reset" onclick="reset()">Start over</button>
        <div id="bip"></div>
        <div id="bip2"></div>
        <div id="bip3"></div>
    </div>


    <!-- ajouter vos boutons de déplacement ici -->


</body>

<!----------------- JAVASCRIPT ----------------->

<script language="JavaScript">
    var m='m'; //représente un mur
    var p='p'; //représente le personnage
    var b='b'; //représente le chemin
    var f="f"; //représente le trophée
    var xdeb =0;
    var ydeb=0;
    var nbrLigne = 5;
    var nbrCol = 7;
    var xperso=1; //position initial du personnage sur l'axe X
    var yperso=1; //postition initial du personnage sur l'axe Y
    //tableau à double entrée représentant votre labyrinthe, vous pouvez le modifier pour comprendre le fonctionnement
    var laby = [[m,m,m,m,m,m,m],
                [m,b,m,m,m,m,m],
                [m,b,m,m,m,m,m],
                [b,b,b,p,b,f,m],
                [m,m,m,m,m,m,m]];





    function afficheLaby() //ne rien modifier dans cette fonction
    {
        var leLaby=document.getElementById("laby");
        insertion="<table border=0 cellspacing=0 cellpadding=0>";


        for(i=0;i<5;i++)
        {
        insertion+="<tr>";
            for(j=0;j<7;j++)
            {

                if (laby[i][j]==m)
                {
                insertion+="<td>";
                insertion+="<img width='52'height='52' src='Assets/stonewall.png'>";
                insertion+="</td>";
                }
                if (laby[i][j]==p)
                {
                insertion+="<td>";
                insertion+="<img width='52' height='52' style='background-image:Assets/Ground.png' src='Assets/Heros.png'>";
                insertion+="</td>";
                }
                if (laby[i][j]==b)
                {
                insertion+="<td>";
                insertion+="<img width='52' height='52' src='Assets/Ground.png'>";
                insertion+="</td>";
                }


                if (laby[i][j]==f)
                {
                insertion+="<td>";
                insertion+="<img width='52' height='52'src='Assets/Trophy.png'>";
                insertion+="</td>";
                }



            }
            insertion+="</tr>";
        }

        insertion+="</table>";
        leLaby.innerHTML=insertion;
    }

    var tempsDebut= 0;
    var tempsFin= 0;
    var pas=0;

    const resetButton = document.querySelector("#reset");
    const theTimer = document.querySelector(".timer");
    var timer= [0, 0, 0, 0];
    var interval;

    function leadingZero(time){
        if (time <= 9) {
            time = "0" + time;
        }

        return time;
    }

    function runTimer(){
        let currentTime = leadingZero(timer[0]) + ":" + leadingZero(timer[1]) + ":" + leadingZero(timer[2]);
        theTimer.innerHTML = currentTime;
        timer[3] ++;

        timer[0] = Math.floor((timer[3]/100)/60);
        timer[1] = Math.floor((timer[3]/100) - (timer[0]*60));
        timer[2]= Math.floor(timer[3] - (timer[1]*100) - (timer[0]*6000));

    }
    function startTimer(){
        interval = setInterval(runTimer, 10);
    }



    function bas(){

        var xNew= xperso;
        var yNew= yperso+1;
        var ancien=laby[yperso][xperso]
        var ligne= laby[yNew];
        var colonne= ligne[xNew];


        if (colonne == b){

            laby[yperso][xperso] = laby[yNew][xNew];
            laby[yNew][xNew] = ancien;
            test=laby[yNew][xNew]
            yperso = yNew;
            xperso = xNew;
            pas++


        } else if (colonne == f) {
          console.log("yeeees");

            laby[yperso][xperso] = b;
            laby[yNew][xNew] = p;
            yperso = yNew;
            xperso = xNew;
            pas++
            alert ("Bravo! Vous avez réussi en " + timer[0] + "minutes " + timer[1] + " secondes " + timer[2] + " milisecondes en " + pas + " pas !");
            clearInterval(interval);
            console.log ("Temps final");

        } else {
            document.getElementById("bip").innerHTML ="Ouch";
        }

        afficheLaby()
    }

    function haut(){

        var xNew= xperso;
        var yNew= yperso-1;
        var ancien=laby[yperso][xperso]
        var ligne= laby[yNew];
        var colonne= ligne[xNew];

        if (colonne == b){


            laby[yperso][xperso] = laby[yNew][xNew];
            laby[yNew][xNew] = ancien;
            yperso = yNew;
            xperso = xNew;
            pas++


        } else if (colonne == f) {

            laby[yperso][xperso] = b
            laby[yNew][xNew] = p;
            yperso = yNew;
            xperso = xNew;
            pas++

            laby[yNew][xNew] = p
            laby
            alert ("Bravo! Vous avez réussi en " + timer[0] + "minutes " + timer[1] + " secondes " + timer[2] + " milisecondes en " + pas + " pas !");
            clearInterval(interval);
            console.log ("Temps final");

        } else {
            document.getElementById("bip").innerHTML ="Ouch";
        }

        afficheLaby()
    }


    function droite(){

        var xNew= xperso+1;
        var yNew= yperso;
        var ancien=laby[yperso][xperso]
        var ligne= laby[yNew];
        var colonne= ligne[xNew];

        if (colonne == b){


            laby[yperso][xperso] = laby[yNew][xNew];
            laby[yNew][xNew] = ancien;
            yperso = yNew;
            xperso = xNew;
            pas++


        } else if (colonne == f) {

            laby[yperso][xperso] = b
            laby[yNew][xNew] = p;
            yperso = yNew;
            xperso = xNew;
            pas++

            alert ("Bravo! Vous avez réussi en " + timer[0] + "minutes " + timer[1] + " secondes " + timer[2] + " milisecondes en " + pas + " pas !");
            clearInterval(interval);
            console.log ("Temps final");

        } else {
            document.getElementById("bip").innerHTML ="Ouch";
        }

        afficheLaby()
    }


    function gauche(){

        var xNew= xperso-1;
        var yNew= yperso;
        var ancien=laby[yperso][xperso]
        var ligne= laby[yNew];
        var colonne= ligne[xNew];

        if (colonne == b){

            laby[yperso][xperso] = laby[yNew][xNew];
            laby[yNew][xNew] = ancien;
            yperso = yNew;
            xperso = xNew;
            pas++


        } else if (colonne == f) {

            laby[yperso][xperso] = b
            laby[yNew][xNew] = p;
            yperso = yNew;
            xperso = xNew;
            pas++

            alert ("Bravo! Vous avez réussi en " + timer[0] + "minutes " + timer[1] + " secondes " + timer[2] + " milisecondes en " + pas + " pas !");
            clearInterval(interval);
            console.log ("Temps final");

        } else {
            document.getElementById("bip").innerHTML ="Ouch";
        }

        afficheLaby()
    }

    document.addEventListener("keydown", event => {
      let coor=recherche();  /* Trouve les coordonnées sous forme de tableau du personnage */
      let xOld= coor[1];
      let yOld= coor[0];
      let xNew= coor[1];
      let yNew= coor[0];

        switch (event.keyCode){
            case 40:
                yNew = yOld + 1;// deplace("D")// bas()
                break
            case 37:
                xNew = xOld - 1;// deplace("L")// gauche()
                break
            case 38:
                yNew = yOld - 1;// deplace("U")// haut()
                break
            case 39:
              xNew = xOld + 1;  // deplace("R")// droite()
                break
        }
          let verif = verification(xNew, yNew)
        if (verif == "chemin" || verif == "trophee") { /* est ce que le personnage peut se deplacer sur la nouvelle case */
            laby[yNew][xNew] = p;
            laby[yOld][xOld] = b;

            console.log("déplacement");
            afficheLaby();

            if (verif == "trophee"){
              alert("gagné");
              go();
            }
         }
    })
 // function deplace(mvt){
 //
 //   let coor=recherche();
 //   let xOld= coor[1];
 //   let yOld= coor[0];
 //   let xNew= coor[1];
 //   let yNew= coor[0];
 //
 //   if (mvt == "R") {
 //     xNew = xOld + 1;
 //   } else if (mvt == "L") {
 //     xNew = xOld - 1;
 //   } else if (mvt == "U") {
 //     yNew = yOld - 1;
 //   } else if (mvt == "D") {
 //     yNew = yOld + 1;
 //   }

//    if (verification(xNew, yNew) == true) {
//       laby[yNew][xNew] = p
//       laby[yOld][xOld] = b
//      console.log("déplacement");
//       afficheLaby()
//
//    } else {
//
//      console.log("bouge pas");
//    }
//
//    console.log(verification(xNew, yNew));
//
// }

function recherche (){
  for (i=0; i<nbrLigne; i++){
    for (j=0; j<nbrCol; j++){
      if (laby[i][j] == p) {
        coord = [i, j];
      }
    }
  } return coord;
}


function verification (x, y) {
  var tVal= laby[y][x];

  if (tVal == b){
    return "chemin";

  } else if (tVal == f){

    return "trophee";
  }
}






    function go(){

        xdeb = xperso;
        ydeb = yperso;
        tempsDebut= new Date();
        laby = [[m,m,m,m,m,m,m],
                    [m,b,m,m,m,m,m],
                    [m,b,m,m,m,m,m],
                    [b,b,b,p,b,f,m],
                    [m,m,m,m,m,m,m]];
        startTimer();
        afficheLaby();
        console.log("temps");
    }

    function reset() {

        clearInterval(interval);
        interval= null;
        timer =[0, 0, 0, 0];
        timerRunning = false;
        oldcase = laby[yperso][xperso]
        newcase = laby[ydeb][xdeb]
        laby[yperso][xperso] = newcase
        laby[ydeb][xdeb] = oldcase
        xperso = xdeb;
        yperso = ydeb;



        bip.innerHTML= "00:00:00";
        console.log("touché");
        afficheLaby()
    }

    resetButton.addEventListener("click", reset, false);

</script>
</html>
